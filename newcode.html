<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prod Calculator - Optimalkan Produktivitas Pertambangan Anda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/21.8.14/i18next.min.js"
        integrity="sha512-jnLk89W5wPny0nKou9w4b/0+jZ3XgWk+O4f5w80xUvw65U9T/7lEV/2Jv+e0H8Y0fM5U+gQj9lG6H33gK7J6w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaY9xUhèœ˜U3Rm2ndN8C4EqmP+tKtQHA+jLc0t/I4lE5QspmR+KnpJOIsbBwDlZxYmW8egQGGkpXGk9PyTzQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-browser-languagedetector/7.1.0/i18nextBrowserLanguageDetector.min.js" integrity="sha512-INOD11hT+C8SDRYQYy+ea+O1jL+aFegWNu05sNq7a9o3OO1jmnwS2MtQiUTW4wkSQ+dQJqnzm9+jFNX8q1xUeg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.2.1/i18nextHTTPBackend.min.js" integrity="sha512-QK2zxy1MDxS7t9EQT7DS4wD1XQvY039jbVZs1O6S4iJm7U8TqVbY11tKxYJmYpB/Xwz4vY+iJ2NfI5mJqgO6w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Default Dark Mode */
        :root {
            --bg-mining: #283442;
            --text-mining: #f0ad4e;
            --border-mining: #f0ad4e;
            --bg-mining-light: #34495e;
            --text-mining-light: #d0d8e0;
            --text-warning: #f39c12;
            --text-success: #2ecc71;
            --bg-orange: #f0ad4e;
            --bg-orange-dark: #e09a3a;
            --bg-blue: #3498db;
            --bg-blue-dark: #2980b9;
            --body-bg: var(--bg-mining);
            --body-text: var(--text-mining-light);
        }

        /* Light Mode Override */
        body.light-mode {
            --bg-mining: #f0f0f0;
            --text-mining: #333;
            --border-mining: #ccc;
            --bg-mining-light: #fff;
            --text-mining-light: #555;
            --body-bg: var(--bg-mining);
            --body-text: var(--text-mining-light);
        }

        body {
            background-color: var(--body-bg);
            font-family: 'Inter', sans-serif;
            color: var(--body-text);
            transition: background-color 0.3s, color 0.3s;
            font-size: 16px;
        }

        .container {
            max-width: 100%;
            padding: 1rem;
            margin: 0;
            /* Tambahkan padding-bottom untuk ruang di atas navbar */
            padding-bottom: 5rem;
            box-sizing: border-box; /* Tambahkan box-sizing */
        }

        h1,
        h2,
        h3 {
            color: var(--text-mining);
            font-weight: 700;
            text-align: center;
        }

        h1 {
            font-size: 1.75rem;
            margin-bottom: 0.75rem;
        }

        h2 {
            font-size: 1.5rem;
        }

        h3 {
            font-size: 1.25rem;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 0.375rem;
            color: var(--text-mining-light);
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-mining);
            border-radius: 0.375rem;
            background-color: var(--bg-mining-light);
            color: var(--text-mining-light);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            margin-bottom: 1rem;
            box-sizing: border-box; /* Tambahkan box-sizing */
        }

        .form-input:focus {
            border-color: var(--text-mining);
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(240, 173, 78, 0.25);
        }

        button[type="submit"],
        #exportPdfBtn {
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            box-sizing: border-box;
            background-color: var(--bg-orange); /* Tambahkan atau ganti ini */
        }

        #exportPdfBtn {
            background-color: var(--bg-blue);
        }

        #exportPdfBtn:hover {
            background-color: var(--bg-blue-dark);
            transform: translateY(-2px);
        }

        #results {
            background-color: var(--bg-mining-light);
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            padding: 1rem;
            margin-top: 0.75rem;
        }

        #results h2 {
            color: var(--text-mining);
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        #results p {
            color: var(--text-mining-light);
            line-height: 1.6;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        #warnings {
            margin-top: 0.75rem;
        }

        .text-warning {
            color: var(--text-warning) !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .text-warning i {
            color: var(--text-warning) !important;
        }

        .text-success {
            color: var(--text-success) !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .text-success i {
            color: var(--text-success) !important;
        }

        #ritaseChart,
        #produktivitasChart {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        /* Bottom Navbar - FIXED */
        .navbar-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-mining-light);
            padding: 0.5rem;
            border-top: 1px solid var(--border-mining);
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-sizing: border-box; /* Tambahkan box-sizing */
        }

        .nav-item-bottom {
            text-align: center;
        }

        .nav-link-bottom {
            color: var(--text-mining-light);
            text-decoration: none;
            display: block;
            transition: color 0.2s ease-in-out;
            font-size: 0.85rem;
        }

        .nav-link-bottom:hover,
        .nav-link-bottom.active {
            color: var(--text-mining);
        }

        .nav-icon-bottom {
            display: block;
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Table Styles */
        .egi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.75rem;
        }

        .egi-table th,
        .egi-table td {
            border: 1px solid var(--border-mining);
            padding: 0.5rem;
            text-align: left;
        }

        .egi-table th {
            background-color: var(--bg-mining-light);
            color: var(--text-mining);
        }

        /* Splash Screen Styles */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-mining);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.5s ease-in-out;
        }

        #splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        #splash-screen h1 {
            color: var(--text-mining);
            font-size: 3rem;
            margin-bottom: 0.75rem;
        }

        #splash-screen p {
            color: var(--text-mining-light);
            font-size: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: var(--bg-mining-light);
            margin: 15% auto;
            padding: 1rem;
            border: 1px solid var(--border-mining);
            width: 80%;
            color: var(--text-mining-light);
            border-radius: 0.5rem;
        }

        .close {
            color: var(--text-mining);
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }

        /* Tambahan penting */
        #prodForm {
            box-sizing: border-box;
            margin-bottom: 2rem; /* Ruang antara form dan elemen berikutnya */

        }

        /* History Styles */
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-mining);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item-details {
            flex-grow: 1;
        }

        .history-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .history-item-details p {
            margin-bottom: 0.25rem;
        }

        .history-item-details p:last-child {
            margin-bottom: 0;
        }

        /* Flex container untuk paginasi dan hapus riwayat */
        /* Style untuk tombol di history */
        .history-button {
            background-color: var(--bg-orange); /* Warna tombol hitung */
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            font-size: 0.85rem;
        }

        .history-button:hover {
            background-color: var(--bg-orange-dark); /* Warna tombol hitung saat dihover */
        }

        #historyDetailModal {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .history-detail-content {
            background-color: var(--bg-mining-light);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--border-mining);
            width: 80%;
            border-radius: 5px;
            color: var(--text-mining-light);
        }

        .history-detail-content .close {
            color: var(--text-mining);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* NEW: Style untuk container tombol history */
        .history-button-container {
            position: fixed;
            bottom: 3.5rem; /* Sesuaikan dengan tinggi navbar-bottom Anda */
            left: 0;
            width: 100%;
            background-color: rgba(40, 52, 66, 0.9); /* Warna latar belakang semi-transparan */
            padding: 0.5rem;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 99; /* Pastikan di atas konten lain */
            box-sizing: border-box;
        }

        /* Sembunyikan secara default */
        .history-button-container {
            display: none;
        }

        /* Tampilkan hanya di history page */
        body #historyPage.active+.history-button-container {
            display: flex;
        }

    </style>
</head>

<body class="bg-mining font-roboto text-mining-light">

    <!-- Splash Screen -->
    <div id="splash-screen">
        <h1>Prod Calculator</h1>
        <p>Memuat...</p>
    </div>

    <!-- Page Container -->
    <div class="container mx-auto">

        <!-- Home Page -->
        <div id="homePage" class="page active">
            <h1 class="text-2xl font-bold text-mining">Prod Calculator</h1>
            <form id="prodForm" class="bg-mining-light p-6 rounded shadow-md">
                <div class="mb-4">
                    <label for="vehicleType" class="form-label">Jenis EGI</label>
                    <select id="vehicleType" class="form-input">
                        <option value="PC1250">PC1250</option>
                        <option value="PC2000-8">PC2000-8</option>
                        <option value="PC2000-11R">PC2000-11R</option>
                        <option value="EX2600">EX2600</option>
                    </select>
                </div>

                <!-- Form Inputs -->
                <div class="mb-4">
                    <label for="wke" class="form-label">Waktu Kerja Efektif (menit)</label>
                    <input type="number" step="0.01" id="wke" class="form-input" min="0" required>
                    <p id="wke-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Waktu Kerja Efektif harus lebih besar dari 0.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="st" class="form-label">Spotting Time (detik)</label>
                    <input type="number" step="0.01" id="st" class="form-input" min="0" required>
                    <p id="st-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Spotting Time harus positif.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="lt" class="form-label">Loading Time (menit)</label>
                    <input type="number" step="0.01" id="lt" class="form-input" min="0" required>
                    <p id="lt-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Loading Time harus positif.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="ct" class="form-label">CT HD (menit)</label>
                    <input type="number" step="0.01" id="ct" class="form-input" min="0" required>
                    <p id="ct-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>CT HD harus positif.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="n" class="form-label">Jumlah HD (unit)</label>
                    <input type="number" step="1" id="n" class="form-input" min="1" required>
                    <p id="n-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Jumlah HD harus lebih besar dari 0.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="s" class="form-label">Jarak Front Ke Disposal (km)</label>
                    <input type="number" step="0.01" id="s" class="form-input" min="0" required>
                    <p id="s-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Jarak Front Ke Disposal harus positif.
                    </p>
                </div>

                <div class="mb-4">
                    <label for="v" class="form-label">Kecepatan HD (km/jam)</label>
                    <input type="number" step="0.1" id="v" class="form-input" max="99.9" min="0" required>
                    <p id="v-error" class="text-red-500 text-sm mt-1 hidden">
                        <i class="fas fa-exclamation-circle mr-1"></i>Kecepatan HD harus positif dan maksimal 99.9 km/jam.
                    </p>
                </div>
                <!-- End Form Inputs -->

                <button type="submit" class="w-full bg-orange text-white p-2 rounded hover:bg-orange-dark">
                    <i class="fas fa-calculator mr-2"></i>Hitung
                </button>
            </form>

            <div id="results" class="hidden mt-6 bg-mining-light p-6 rounded shadow-md">
                <h2 class="text-xl font-bold mb-4 text-mining">Hasil</h2>
                <p id="ritase" class="text-mining-light"><i class="fas fa-truck-loading mr-2"></i>Ritase: -</p>
                <p id="produktivitas" class="text-mining-light"><i class="fas fa-mountain mr-2"></i>Produktivitas: -
                </p>
                <div id="warnings" class="mt-4"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <canvas id="ritaseChart" class="mt-6 bg-white p-4 rounded shadow-md"></canvas>
                    </div>
                    <div>
                        <canvas id="produktivitasChart" class="mt-6 bg-white p-4 rounded shadow-md"></canvas>
                    </div>
                </div>
                <button id="exportPdfBtn" class="mt-4 w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-700">
                    <i class="fas fa-file-pdf mr-2"></i>Export to PDF
                </button>
            </div>
        </div>

        <!-- History Page -->
        <div id="historyPage" class="page">
            <h2 class="text-xl font-bold mb-4 text-mining">Riwayat Perhitungan</h2>
            <div id="historyList">
                <!-- Riwayat akan ditampilkan di sini -->
            </div>

            <!-- Container untuk tombol paginasi dan hapus riwayat -->
            <!-- Container untuk tombol paginasi dan hapus riwayat -->
        </div>

        <!-- History Detail Modal -->
        <div id="historyDetailModal" class="modal">
            <div class="history-detail-content">
                <span class="close" onclick="closeHistoryDetailModal()">Ã—</span>
                <h2 class="text-xl font-bold mb-4 text-mining">Detail Perhitungan</h2>
                <div id="historyDetailContent">
                    <!-- Detail riwayat akan ditampilkan di sini -->
                </div>
            </div>
        </div>

        <!-- Info EGI Page -->
        <div id="infoEgiPage" class="page">
            <h2 class="text-xl font-bold mb-4 text-mining">Informasi Target EGI</h2>
            <div id="egiInfo">
                <table class="egi-table">
                    <thead>
                        <tr>
                            <th>Jenis EGI</th>
                            <th>Target Ritase</th>
                            <th>Target Produktivitas</th>
                            <th>Cycle Time</th>
                            <th>Loading Time</th>
                            <th>Jumlah Passing</th>
                            <th>Target Speed </th>
                            <th>Target Payload </th>
                            <th>Target Spotting Time </th> <!-- Kolom Baru -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>PC1250</td>
                            <td>15 Rit / Jam</td>
                            <td>525 Bcm / Jam</td>
                            <td>24 Detik</td>
                            <td>3.2 Menit</td>
                            <td>8 Passing</td>
                            <td>-</td>
                            <td>105 Ton</td>
                            <td>11 Detik</td>
                        </tr>
                        <tr>
                            <td>PC2000-8</td>
                            <td>21 Rit / Jam</td>
                            <td>800 Bcm / Jam</td>
                            <td>26 Detik</td>
                            <td>2.16 Menit</td>
                            <td>5 Passing</td>
                            <td>-</td>
                            <td>105 Ton</td>
                            <td>11 Detik</td>
                        </tr>
                        <tr>
                            <td>PC2000-11R</td>
                            <td>24 Rit / Jam</td>
                            <td>950 Bcm / Jam</td>
                            <td>28 Detik</td>
                            <td>1.86 Menit</td>
                            <td>4 Passing</td>
                            <td>-</td>
                            <td>105 Ton</td>
                            <td>11 Detik</td>
                        </tr>
                        <tr>
                            <td>EX2600</td>
                            <td>30 Rit / Jam</td>
                            <td>1200 Bcm / Jam</td>
                            <td>30 Detik</td>
                            <td>1.5 Menit</td>
                            <td>3 Passing</td>
                            <td>-</td>
                            <td>105 Ton</td>
                            <td>11 Detik</td>
                        </tr>
                        <tr>
                            <td>HD 785 - 7</td>
                            <td>-</td>
                            <td>231 Bcm / Jam</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>23 Km / Jam</td>
                            <td>105 Ton</td>
                            <td>11 Detik</td> <!-- Isi jika ada data -->
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page">
            <h2 class="text-xl font-bold mb-4 text-mining">Pengaturan</h2>
            <div class="mb-4">
                <label for="themeToggle" class="form-label">Mode Tampilan</label>
                <select id="themeToggle" class="form-input">
                    <option value="dark">Gelap</option>
                    <option value="light">Terang</option>
                </select>
            </div>
            <!-- Tambahkan bagian ini -->
            <div class="mb-4">
                <label for="languageSelect" class="form-label">Pilih Bahasa</label>
                <select id="languageSelect" class="form-input">
                    <option value="id">Bahasa Indonesia</option>
                    <option value="en">English</option>
                    <!-- Tambahkan opsi bahasa lain di sini -->
                </select>
            </div>
        </div>

        <!-- Modal -->
        <div id="infoModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeInfoModal()">Ã—</span>
                <h2 class="text-xl font-bold mb-4 text-mining">Informasi Target EGI</h2>
                <div id="egiInfoModal"></div>
            </div>
        </div>
    </div>

    <!-- NEW: Container untuk tombol-tombol riwayat-->
    <div class="history-button-container">
        <button id="prevPageBtn" class="history-button" disabled>Sebelumnya</button>
        <button id="clearHistoryBtn" class="history-button">Hapus Semua Riwayat</button>
        <button id="nextPageBtn" class="history-button">Selanjutnya</button>
    </div>


    <!-- Bottom Navbar -->
    <nav class="navbar-bottom">
        <div class="nav-item-bottom">
            <a class="nav-link-bottom active" href="#" onclick="showPage('homePage', this)">
                <i class="fas fa-home nav-icon-bottom"></i>
                Beranda
            </a>
        </div>
        <div class="nav-item-bottom">
            <a class="nav-link-bottom" href="#" onclick="showPage('historyPage', this)">
                <i class="fas fa-history nav-icon-bottom"></i>
                Riwayat
            </a>
        </div>
        <div class="nav-item-bottom">
            <a class="nav-link-bottom" href="#" onclick="showPage('infoEgiPage', this)">
                <i class="fas fa-info-circle nav-icon-bottom"></i>
                Info EGI
            </a>
        </div>
        <div class="nav-item-bottom">
            <a class="nav-link-bottom" href="#" onclick="showPage('settingsPage', this)">
                <i class="fas fa-cog nav-icon-bottom"></i>
                Pengaturan
            </a>
        </div>
    </nav>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Konfigurasi Toastr
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        // Data Target EGI
        const targetValues = {
            'PC1250': { ritase: 15, wke: 60, ct: 15, st: 11, produktivitas: 525, cycleTime: 24, lt: 3.2 },
            'PC2000-8': { ritase: 21, wke: 60, ct: 14, st: 11, produktivitas: 800, cycleTime: 26, lt: 2.16 },
            'PC2000-11R': { ritase: 24, wke: 60, ct: 11, st: 11, produktivitas: 950, cycleTime: 28, lt: 1.86 },
            'EX2600': { ritase: 30, wke: 60, produktivitas: 1200, cycleTime: 30, lt: 1.5, st: 11, ct: 0 } //CT diisi 0 karena di table info tidak ada value nya
        };

        let ritaseChart;
        let produktivitasChart;

        // Fungsi untuk mendapatkan data formulir
        function getFormData() {
            return {
                vehicleType: document.getElementById('vehicleType').value,
                wke: parseFloat(document.getElementById('wke').value),
                st: parseFloat(document.getElementById('st').value),
                lt: parseFloat(document.getElementById('lt').value),
                ct: parseFloat(document.getElementById('ct').value),
                n: parseFloat(document.getElementById('n').value),
                s: parseFloat(document.getElementById('s').value),
                v: parseFloat(document.getElementById('v').value)
            };
        }


        // Fungsi untuk menampilkan pesan kesalahan
        function showError(fieldId, message) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            } else {
                toastr.error(message, "Error");
            }
        }

        // Fungsi untuk menyembunyikan pesan kesalahan
        function hideError(fieldId) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            if (errorElement) {
                errorElement.classList.add('hidden');
            }
        }

        // Fungsi untuk validasi input
        function validateForm(formData) {
            let isValid = true;

            // Validasi Waktu Kerja Efektif (WKE)
            if (isNaN(formData.wke) || formData.wke <= 0) {
                showError('wke', 'Waktu Kerja Efektif harus berupa angka dan lebih besar dari 0.');
                isValid = false;
            } else {
                hideError('wke');
            }

            // Validasi Spotting Time (ST)
            if (isNaN(formData.st) || formData.st < 0) {
                showError('st', 'Spotting Time harus berupa angka positif.');
                isValid = false;
            } else {
                hideError('st');
            }

            // Validasi Loading Time (LT)
            if (isNaN(formData.lt) || formData.lt < 0) {
                showError('lt', 'Loading Time harus berupa angka positif.');
                isValid = false;
            } else {
                hideError('lt');
            }

            // Validasi CT HD
            if (isNaN(formData.ct) || formData.ct < 0) {
                showError('ct', 'CT HD harus berupa angka positif.');
                isValid = false;
            } else {
                hideError('ct');
            }

            // Validasi Jumlah HD
            if (isNaN(formData.n) || formData.n <= 0) {
                showError('n', 'Jumlah HD harus berupa angka dan lebih besar dari 0.');
                isValid = false;
            } else {
                hideError('n');
            }

            // Validasi Jarak Front Ke Disposal
            if (isNaN(formData.s) || formData.s < 0) {
                showError('s', 'Jarak Front Ke Disposal harus berupa angka positif.');
                isValid = false;
            } else {
                hideError('s');
            }

            // Validasi Kecepatan HD
            if (isNaN(formData.v) || formData.v < 0 || formData.v > 99.9) {
                showError('v', 'Kecepatan HD harus berupa angka positif dan maksimal 99.9 km/jam.');
                isValid = false;
            } else {
                hideError('v');
            }

            return isValid;
        }

        // Fungsi untuk melakukan perhitungan
        function calculateResults(formData) {
            const { vehicleType, wke, st, lt, ct, n, s, v } = formData;
            const target = targetValues[vehicleType];

            if (!target) {
                toastr.error("Tipe kendaraan tidak valid.", "Error");
                return null;
            }

            //Konversi satuan kecepatan dari Km/jam ke Km/menit
            const kecepatanKmPerMenit = v / 60;

            // Calculate target ideal CT
            const targetIdealLt = target.lt;
            const targetIdealSt = target.st / 60;
            const targetIdealCt = (((s / 23) * 60) + 1) + targetIdealSt + targetIdealLt;

            // Calculate actual CT
            const actualCt = (((s / v) * 60) + 1) + (st / 60) + lt;

            // Calculate ritase and productivity
            const ritase = Math.round((wke / ((ct) + targetIdealSt + targetIdealLt)) * n);
            const produktivitas = Math.round(ritase * 42);

            return {
                ritase,
                produktivitas,
                targetRitase: target.ritase,
                targetProduktivitas: target.produktivitas,
                wke,
                st,
                v,
                ct,
                lt,
                target,
                targetIdealCt, //Hanya return target ideal CT, karena actual CT sudah dihapus
                vehicleType
            };
        }

        // Fungsi untuk menampilkan hasil perhitungan
        function displayResults(results) {
            if (!results) return;

            document.getElementById('ritase').innerHTML = `<i class="fas fa-truck-loading mr-2"></i>Ritase: ${results.ritase} Rit/Jam`;
            document.getElementById('produktivitas').innerHTML = `<i class="fas fa-mountain mr-2"></i>Produktivitas: ${results.produktivitas} Bcm/Jam`;
            document.getElementById('results').classList.remove('hidden');
        }

        // Konfigurasi (Magic Numbers disimpan di sini untuk kemudahan pemeliharaan)
        const konfigurasi = {
            kecepatanIdealHD: 23, // Kecepatan ideal Hauling Truck (HD) dalam km/jam
            waktuKerjaEfektifIdeal: 60 // Waktu Kerja Efektif (WKE) ideal dalam menit
        };

        // Data Target EGI (Letakkan di sini, sebelum fungsi lain)
        const targetData = {
            'PC1250': { targetSpottingTime: 11, loadingTime: 3.2 },
            'PC2000-8': { targetSpottingTime: 11, loadingTime: 2.16 },
            'PC2000-11R': { targetSpottingTime: 11, loadingTime: 1.86 },
            'EX2600': { targetSpottingTime: 11, loadingTime: 1.5 }
        };

        /**
         * Fungsi pembantu untuk membulatkan angka ke dua tempat desimal dan mengembalikan string.
         * Digunakan untuk memastikan format angka yang konsisten.
         * @param {number} num Angka yang akan dibulatkan.
         * @returns {string} Angka yang dibulatkan sebagai string.
         */
        function roundToTwo(num) {
            return +(Math.round(num + "e+2") + "e-2");
        }

        /**
         * Fungsi pembantu untuk menghilangkan ".00" dari angka jika bilangan bulat.
         * Contoh: 10.00 menjadi 10, 9.50 menjadi 9.5
         * @param {number|string} num Angka yang akan diformat.
         * @returns {string} Angka yang diformat sebagai string.
         */
        function formatNumberWithoutDecimals(num) {
            const formattedNum = Number(num).toFixed(2);
            const numStr = formattedNum.replace(/\.00$/, ''); // Hilangkan .00
            return numStr.replace(/\.([0-9])0$/, '.$1'); // Hilangkan angka 0 di belakang koma (contoh: .70 menjadi .7)
        }

        /**
         * Fungsi pembantu untuk membuat teks saran ritase.
         * Menghitung dan menyajikan potensi perubahan ritase berdasarkan perbaikan yang disarankan.
         * @param {number} perkiraanRitase Ritase yang diperkirakan setelah perbaikan.
         * @param {number} targetRitase Target ritase yang diinginkan.
         * @param {number} ritaseSaatIni Ritase saat ini.
         * @returns {string} Teks saran ritase.
         */
        function createRitaseSuggestionText(perkiraanRitase, targetRitase, ritaseSaatIni) {
            // Bulatkan semua nilai ritase *untuk ditampilkan* (tapi gunakan nilai aslinya untuk perhitungan)
            const perkiraanRitaseBulat = formatNumberWithoutDecimals(perkiraanRitase);
            const ritaseSaatIniBulat = Math.round(ritaseSaatIni);

            const selisihRitase = perkiraanRitase - ritaseSaatIni; //Hitung selisihnya

            if (selisihRitase < 0) {
                // Perkiraan ritase lebih rendah, tampilkan pesan penurunan
                const potensiPenurunanBulat = Math.round(Math.abs(selisihRitase));

                return ` Ini berpotensi menyebabkan penurunan ritase sekitar ${formatNumberWithoutDecimals(perkiraanRitaseBulat)} rit/jam dari ritase saat ini ${formatNumberWithoutDecimals(ritaseSaatIniBulat)} rit/jam, yaitu penurunan sebanyak ${formatNumberWithoutDecimals(potensiPenurunanBulat)} rit/jam.`;
            } else if (selisihRitase > 0) {
                // Perkiraan ritase sama atau lebih tinggi, tampilkan pesan perbaikan
                const peningkatanRitaseBulat = formatNumberWithoutDecimals(selisihRitase);

                return ` Ini berpotensi menyebabkan peningkatan ritase sekitar ${formatNumberWithoutDecimals(perkiraanRitaseBulat)} rit/jam dari ritase saat ini ${formatNumberWithoutDecimals(ritaseSaatIniBulat)} rit/jam, yaitu peningkatan sebanyak ${formatNumberWithoutDecimals(peningkatanRitaseBulat)} rit/jam.`;
            } else {
                // Selisih ritase adalah 0, tampilkan pesan netral
                return ` Perubahan ini diperkirakan tidak akan memengaruhi ritase.`;
            }
        }

        /**
         * Fungsi utama untuk menghasilkan peringatan dan saran berdasarkan hasil perhitungan dan data formulir.
         * @param {object} results Objek yang berisi hasil perhitungan (ritase, produktivitas, dll.).
         * @param {object} formData Objek yang berisi data formulir yang dimasukkan pengguna.
         * @returns {string} HTML yang berisi peringatan dan saran
         */
        function generateWarnings(results, formData) {
            let warnings = '';

            try {
                // Destructuring objek hasil dan formulir dengan nilai default untuk menghindari error
                const {
                    produktivitas = 0,
                    targetRitase = 0,
                    targetProduktivitas = 0,
                    wke = 0,
                    st = 0,
                    v = 0,
                    ct = 0,
                    lt = 0,
                    target = {}, // Objek default kosong
                    targetIdealCt = 0,
                    vehicleType = 'Unknown', // Nilai default string
                    s: jarakHauling = 0 // Ganti 's' dengan nama yang lebih deskriptif, nilai default 0
                } = results || {}; // Objek default kosong jika results undefined

                const { n: jumlahHD = 1 } = formData || {}; // Jumlah HD, nilai default 1 jika undefined

                console.log("Vehicle Type:", vehicleType);
                console.log("ct (Cycle Time input pengguna):", ct);
                console.log("jumlahHD (Jumlah HD):", jumlahHD); // Tambahkan log untuk jumlahHD
                console.log("targetIdealCt (Target Ideal Cycle Time):", targetIdealCt);

                const dataTargetEGI = targetData[vehicleType];

                if (!dataTargetEGI) {
                    console.warn("Jenis EGI tidak ditemukan dalam data target:", vehicleType);
                    return `<p class="text-danger">Jenis EGI tidak dikenal: ${vehicleType}. Tidak dapat memberikan saran yang akurat.</p>`;
                }
                const targetIdealSt = dataTargetEGI.targetSpottingTime / 60; // Konversi ke menit
                const targetIdealLt = dataTargetEGI.loadingTime;

                // Hitung ritase awal menggunakan rumus yang sama *dengan jumlahHD*
                const ritase = Math.round((wke / ((ct) + targetIdealSt + targetIdealLt)) * jumlahHD);

                // Periksa apakah target produktivitas dan ritase sudah tercapai
                if (ritase >= targetRitase && produktivitas >= targetProduktivitas) {
                    warnings = `<p class="text-success"><i class="fas fa-check-circle mr-2"></i>Target Produktivitas/Ritase sudah tercapai, PERTAHANKAN!!!</p>`;
                } else {
                    // Peringatan umum jika target belum tercapai
                    warnings = `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Produktivitas di bawah target (${formatNumberWithoutDecimals(targetProduktivitas)} Bcm/Jam) dan/atau Ritase di bawah target (${formatNumberWithoutDecimals(targetRitase)} Rit/Jam).</p>`;
                    warnings += '<p class="text-mining-light"><i class="fas fa-lightbulb mr-2"></i>Untuk mencapai target di atas, maka perlu beberapa perbaikan:</p>';

                    // 1. Saran WKE (Waktu Kerja Efektif)
                    if (wke !== konfigurasi.waktuKerjaEfektifIdeal) {
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Waktu Kerja Efektif idealnya ${formatNumberWithoutDecimals(konfigurasi.waktuKerjaEfektifIdeal)} menit.</p>`;
                        const wkeDiff = Math.abs(wke - konfigurasi.waktuKerjaEfektifIdeal);
                        const perkiraanWKEBaru = konfigurasi.waktuKerjaEfektifIdeal;

                        // Hitung ritase baru *dengan WKE yang baru dan jumlahHD*
                        const perkiraanRitaseKarenaWKE = Math.round((perkiraanWKEBaru / ((ct) + targetIdealSt + targetIdealLt)) * jumlahHD);

                        let ritaseSuggestionText = `Saran: ${wke > konfigurasi.waktuKerjaEfektifIdeal ? 'Kurangi' : 'Tingkatkan'} Waktu Kerja Efektif sebanyak ${formatNumberWithoutDecimals(wkeDiff)} menit.`;
                        ritaseSuggestionText += createRitaseSuggestionText(perkiraanRitaseKarenaWKE, targetRitase, ritase);
                        warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${ritaseSuggestionText}</p>`;
                    }

                    // 2. Saran Spotting Time (ST)
                    if (target && target.st !== undefined && st !== target.st) {
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Spotting Time sebaiknya ${formatNumberWithoutDecimals(target.st)} detik.</p>`;

                        const stDiff = Math.abs(st - target.st);

                        // Hitung ritase baru *dengan CT yang baru dan jumlahHD*
                        const perkiraanRitaseKarenaST = Math.round((wke / ((ct) + targetIdealSt + targetIdealLt)) * jumlahHD);

                        let ritaseSuggestionText = `Saran: Kurangi Spotting Time sebanyak ${formatNumberWithoutDecimals(stDiff)} detik.`;
                        ritaseSuggestionText += createRitaseSuggestionText(perkiraanRitaseKarenaST, targetRitase, ritase);
                        warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${ritaseSuggestionText}</p>`;
                    }

                    // 3. Saran Loading Time (LT)
                    if (target && target.lt !== undefined) {
                        if (lt < target.lt) {
                            warnings += `<p class="text-success"><i class="fas fa-check-circle mr-2"></i>Loading Time sudah ideal (dibawah atau sama dengan ${formatNumberWithoutDecimals(target.lt)} menit). PERTAHANKAN!</p>`;
                        } else if (lt > target.lt) {
                            warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Loading Time saat ini melebihi target ideal. Loading Time sebaiknya ${formatNumberWithoutDecimals(target.lt)} menit.</p>`;
                            const ltDiff = Math.abs(lt - target.lt);

                            // Hitung ritase baru *dengan target Loading Time*
                            const perkiraanRitaseKarenaLT = Math.round((wke / ((ct) + targetIdealSt + targetIdealLt)) * jumlahHD);

                            let ritaseSuggestionText = `Saran: Kurangi Loading Time sebanyak ${formatNumberWithoutDecimals(ltDiff)} menit.`;
                            ritaseSuggestionText += createRitaseSuggestionText(perkiraanRitaseKarenaLT, targetRitase, ritase);
                            warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${ritaseSuggestionText}</p>`;
                        }
                    }

                    // 4. Saran Cycle Time HD (CT)
                    if (ct > targetIdealCt) {
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: CT HD sebaiknya ${formatNumberWithoutDecimals(targetIdealCt)} menit.</p>`;
                        const ctDiff = Math.abs(ct - targetIdealCt);

                        // Hitung ritase baru *dengan CT yang baru dan jumlahHD*
                        const perkiraanRitaseKarenaCT = Math.round((wke / ((targetIdealCt) + targetIdealSt + targetIdealLt)) * jumlahHD);

                        let ritaseSuggestionText = `Saran: Kurangi CT HD sebanyak ${formatNumberWithoutDecimals(ctDiff)} menit, Cycle time Baru = ${formatNumberWithoutDecimals(targetIdealCt)} menit.`;
                        ritaseSuggestionText += createRitaseSuggestionText(perkiraanRitaseKarenaCT, targetRitase, ritase);
                        warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${ritaseSuggestionText}</p>`;
                    }

                    // 5. Saran Jumlah HD (Hauling Truck)
                    const hdDiff = Math.ceil(targetRitase / (wke / (ct + targetIdealSt + targetIdealLt)) - jumlahHD);
                    if (hdDiff > 0) {
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Jumlah HD sebaiknya ditingkatkan sebanyak ${formatNumberWithoutDecimals(hdDiff)} unit.</p>`;

                        // Hitung perkiraan ritase dengan jumlah HD yang baru
                        const perkiraanRitaseKarenaHD = Math.round((wke / ((ct) + targetIdealSt + targetIdealLt)) * (jumlahHD + hdDiff));

                        let hdSuggestionTextSaran = `Saran: Tingkatkan Jumlah HD sebanyak ${formatNumberWithoutDecimals(hdDiff)} unit.`;
                        // Tambahkan createRitaseSuggestionText hanya jika ritase belum melebihi target
                        if (ritase < targetRitase) {
                            hdSuggestionTextSaran += createRitaseSuggestionText(perkiraanRitaseKarenaHD, targetRitase, ritase);
                        }
                        warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${hdSuggestionTextSaran}</p>`;
                    }
                    // 6. Saran Kecepatan HD
                    if (v < konfigurasi.kecepatanIdealHD) {
                        console.log("Saran Kecepatan HD: v =", v);
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i>Peringatan: Kecepatan HD sebaiknya ${formatNumberWithoutDecimals(konfigurasi.kecepatanIdealHD)} Km/jam.</p>`;
                        const vDiff = Math.abs(v - konfigurasi.kecepatanIdealHD);
                        const vTarget = konfigurasi.kecepatanIdealHD;

                        // Ambil nilai jarakHauling dan kecepatan dari input dan trim spasi
                        console.log("Mengambil nilai dari input...");
                        const jarakHaulingStr = document.getElementById('s') ? document.getElementById('s').value.trim() : '0';
                        const vStr = document.getElementById('v') ? document.getElementById('v').value.trim() : '0';

                        // Konversi ke angka
                        console.log("Konversi ke angka...");
                        const jarakHauling = parseFloat(jarakHaulingStr);
                        const kecepatanHDInput = parseFloat(vStr); // Variabel baru untuk nilai input

                        // Pemeriksaan untuk nilai jarakHauling dan v yang valid
                        console.log("Validasi nilai...");
                        if (isNaN(jarakHauling) || jarakHauling <= 0) {
                            console.error("Jarak (s) tidak valid!");
                            warnings += `<p class="text-warning">Jarak Front Ke Disposal tidak valid, tidak dapat memberikan saran kecepatan.</p>`;
                        } else if (isNaN(kecepatanHDInput) || kecepatanHDInput <= 0) {
                            console.error("Kecepatan (v) tidak valid!");
                            warnings += `<p class="text-warning">Kecepatan HD tidak valid, tidak dapat memberikan saran kecepatan.</p>`;
                        } else {
                            // Semua nilai valid, lakukan perhitungan
                            console.log("Semua nilai valid, melakukan perhitungan...");
                            const MINUTES_PER_HOUR = 60;
                            const FIXED_TIME = 1;

                            const ctSaatIni = (((jarakHauling / kecepatanHDInput) * MINUTES_PER_HOUR) + FIXED_TIME) + (st / MINUTES_PER_HOUR) + lt;
                            const ctTarget = (((jarakHauling / vTarget) * MINUTES_PER_HOUR) + FIXED_TIME) + (st / MINUTES_PER_HOUR) + lt;
                            const ctReduction = ctSaatIni - ctTarget;
                            const perkiraanRitaseKarenaV = Math.round((wke / ((ctTarget) + targetIdealSt + targetIdealLt)) * jumlahHD);

                            let vSuggestionText = `Saran: Tingkatkan kecepatan HD sebanyak ${formatNumberWithoutDecimals(vDiff)} km/jam. Ini berpotensi mengurangi Cycle Time HD sebanyak ${formatNumberWithoutDecimals(ctReduction)} menit.`;
                            vSuggestionText += createRitaseSuggestionText(perkiraanRitaseKarenaV, targetRitase, ritase);
                            warnings += `<p class="text-mining-light"><i class="fas fa-tools mr-2"></i>${vSuggestionText}</p>`;
                        }
                    }
                }

                // Saran untuk mengurangi jumlah HD jika ritase terlalu tinggi
                if (ritase > targetRitase) {
                    console.log("Ritase melebihi target!");
                    const excessRitase = ritase - targetRitase;
                    const hdReduction = Math.floor(excessRitase / 2);
                    console.log("Kelebihan ritase:", excessRitase);
                    console.log("Pengurangan HD:", hdReduction);
                    if (hdReduction > 0) {
                        warnings += `<p class="text-warning"><i class="fas fa-exclamation-triangle mr-2"></i> Ritase melebihi target. Sebaiknya kurangi jumlah HD sebanyak ${formatNumberWithoutDecimals(hdReduction)} unit.</p>`;
                    }
                }
            } catch (error) {
                console.error("Terjadi kesalahan dalam generateWarnings:", error);
                warnings = `<p class="text-danger"><i class="fas fa-exclamation-circle mr-2"></i>Terjadi kesalahan: ${error.message}.  Periksa input Anda.</p>`;
            }

            return warnings;
        }

// Contoh Penggunaan (Untuk Tujuan Pengujian)
const resultsExample = {
    ritase: 9,
    produktivitas: 378,
    targetRitase: 15,
    targetProduktivitas: 525,
    wke: 58,
    st: 40,
    v: 20,
    ct: 17,
    lt: 3.4,
    target: { st: 35, lt: 3.2 },
    targetIdealCt: 12.21,
    vehicleType: 'HD785',
    s: 2
};

const formDataExample = {
    n: 7
};

const warningsHTML = generateWarnings(resultsExample, formDataExample);
console.log(warningsHTML);

// Anda dapat menyisipkan warningsHTML ke dalam elemen HTML dengan ID "warningsContainer" seperti ini:
// document.getElementById('warningsContainer').innerHTML = warningsHTML;

// Fungsi untuk memformat angka tanpa desimal jika bilangan bulat
function formatNumber(num) {
  if (Number.isInteger(Number(num))) {
    return Number(num);
  } else {
    return Number(num).toFixed(2);
  }
}

        // Fungsi untuk membuat atau memperbarui grafik
        function createCharts(results) {
            if (!results) return;

            const { ritase, produktivitas, targetRitase, targetProduktivitas } = results;

            const chartOptions = {
                type: 'bar',
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nilai'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Parameter'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.parsed.y;
                                    return label;
                                }
                            }
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 1500,
                        easing: 'easeInOutQuad'
                    }
                }
            };

            const ritaseData= {
                labels: ['Ritase'],
                datasets: [{
                    label: 'Aktual',
                    data: [ritase],
                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Target',
                    data: [targetRitase],
                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            };

            const produktivitasData = {
                labels: ['Produktivitas'],
                datasets: [{
                    label: 'Aktual',
                    data: [produktivitas],
                    backgroundColor: 'rgba(75, 192, 192, 0.7)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Target',
                    data: [targetProduktivitas],
                    backgroundColor: 'rgba(255, 206, 86, 0.7)',
                    borderColor: 'rgba(255, 206, 86, 1)',
                    borderWidth: 1
                }]
            };

            createOrUpdateChart('ritaseChart', ritaseData, chartOptions);
            createOrUpdateChart('produktivitasChart', produktivitasData, chartOptions);
        }

        function createOrUpdateChart(chartId, chartData, options) {
            const ctx = document.getElementById(chartId).getContext('2d');

            if (ctx) {
                // Hancurkan instance chart sebelumnya jika ada
                if (chartId === 'ritaseChart' && ritaseChart) {
                    ritaseChart.destroy();
                } else if (chartId === 'produktivitasChart' && produktivitasChart) {
                    produktivitasChart.destroy();
                }

                // Buat instance chart baru
                if (chartId === 'ritaseChart') {
                    ritaseChart = new Chart(ctx, {
                        type: options.type,
                        data: chartData,
                        options: options.options
                    });
                } else if (chartId === 'produktivitasChart') {
                    produktivitasChart = new Chart(ctx, {
                        type: options.type,
                        data: chartData,
                        options: options.options
                    });
                }
            } else {
                console.error('Tidak dapat mendapatkan konteks 2D untuk ' + chartId);
            }
        }

        // Array untuk menyimpan riwayat perhitungan
        let calculationHistory = [];
        const itemsPerPage = 5; // Jumlah item per halaman
        let currentPage = 1;     // Halaman saat ini

        // Fungsi untuk menyimpan perhitungan ke dalam riwayat
        function saveToHistory(formData, results) {
            const historyItem = {
                timestamp: new Date().toLocaleString(),
                formData: formData,
                results: results
            };
        
            // Periksa apakah item yang sama sudah ada
            const alreadyExists = calculationHistory.some(item => {
                return (
                    item.timestamp === historyItem.timestamp &&
                    JSON.stringify(item.formData) === JSON.stringify(historyItem.formData) &&
                    JSON.stringify(item.results) === JSON.stringify(historyItem.results)
                );
            });
        
            if (!alreadyExists) {
                calculationHistory.push(historyItem);
                localStorage.setItem('calculationHistory', JSON.stringify(calculationHistory));
                updateHistoryList();
            } else {
                console.log("Riwayat sudah ada, tidak disimpan lagi.");
            }
        }
        
        let historyLoaded = false; // Flag baru
        
        // Fungsi untuk memuat riwayat dari localStorage saat halaman dimuat
        function loadHistory() {
              console.log("loadHistory() dipanggil");
              if (!historyLoaded) {
                  const storedHistory = localStorage.getItem('calculationHistory');
                  if (storedHistory) {
                      calculationHistory = JSON.parse(storedHistory);
                  }
                  updateHistoryList();
                  historyLoaded = true; // Set flag ke true
              } else {
                  console.log("loadHistory() diabaikan: sudah dimuat sebelumnya");
              }
          }

        // Fungsi untuk menampilkan detail riwayat dalam modal
        function showHistoryDetail(index) {
            const item = calculationHistory[index];
            const detailContent = `
                <p><strong>Waktu:</strong> ${item.timestamp}</p>
                <p><strong>Jenis EGI:</strong> ${item.formData.vehicleType}</p>
                <p><strong>Waktu Kerja Efektif:</strong> ${item.formData.wke}</p>
                <p><strong>Spotting Time:</strong> ${item.formData.st}</p>
                <p><strong>Loading Time:</strong> ${item.formData.lt}</p>
                <p><strong>CT HD:</strong> ${item.formData.ct}</p>
                <p><strong>Jumlah HD:</strong> ${item.formData.n}</p>
                <p><strong>Jarak Front Ke Disposal:</strong> ${item.formData.s}</p>
                <p><strong>Kecepatan HD:</strong> ${item.formData.v}</p>
                <hr>
                <p><strong>Ritase:</strong> ${item.results.ritase} Rit/Jam</p>
                <p><strong>Produktivitas:</strong> ${item.results.produktivitas} Bcm/Jam</p>
            `;
            document.getElementById('historyDetailContent').innerHTML = detailContent;
            document.getElementById('historyDetailModal').style.display = 'block';
        }

        // Fungsi untuk menutup modal detail riwayat
        function closeHistoryDetailModal() {
            document.getElementById('historyDetailModal').style.display = 'none';
        }

        // Fungsi untuk menghapus item riwayat
        function deleteHistoryItem(index) {
            calculationHistory.splice(index, 1);
            localStorage.setItem('calculationHistory', JSON.stringify(calculationHistory));
            updateHistoryList();
        }

        // Fungsi untuk menghapus semua riwayat
        function clearHistory() {
            calculationHistory = [];
            localStorage.removeItem('calculationHistory');
            updateHistoryList();
        }

        // Fungsi untuk mengupdate tampilan daftar riwayat dengan paginasi
        function updateHistoryList() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentHistory = calculationHistory.slice(startIndex, endIndex);

            currentHistory.forEach((item, index) => {
                const globalIndex = startIndex + index;  // index dalam array calculationHistory

                const historyItemElement = document.createElement('div');
                historyItemElement.classList.add('history-item');

                const historyItemDetails = document.createElement('div');
                historyItemDetails.classList.add('history-item-details');
                historyItemDetails.innerHTML = `
                    <p><strong>Waktu:</strong> ${item.timestamp}</p>
                    <p><strong>Jenis EGI:</strong> ${item.formData.vehicleType}, <strong>WKE:</strong> ${item.formData.wke}, <strong>Jumlah HD:</strong> ${item.formData.n}</p>
                    <p><strong>Ritase:</strong> ${item.results.ritase} Rit/Jam, <strong>Produktivitas:</strong> ${item.results.produktivitas} Bcm/Jam</p>
                `;
                historyItemElement.appendChild(historyItemDetails);

                const historyItemActions = document.createElement('div');
                historyItemActions.classList.add('history-item-actions');

                const detailButton = document.createElement('button');
                detailButton.textContent = 'Detail';
                detailButton.classList.add('history-delete-btn'); // Menggunakan style yang sama dengan tombol delete
                detailButton.onclick = () => showHistoryDetail(globalIndex);
                historyItemActions.appendChild(detailButton);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Hapus';
                deleteButton.classList.add('history-delete-btn');
                deleteButton.onclick = () => deleteHistoryItem(globalIndex);
                historyItemActions.appendChild(deleteButton);

                historyItemElement.appendChild(historyItemActions);

                historyList.appendChild(historyItemElement);
            });

            updatePaginationButtons();
        }

        // Fungsi untuk mengupdate tombol paginasi
        function updatePaginationButtons() {
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');

            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage * itemsPerPage >= calculationHistory.length;
        }

        // Event listener untuk tombol halaman sebelumnya
        document.getElementById('prevPageBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updateHistoryList();
            }
        });

        // Event listener untuk tombol halaman selanjutnya
        document.getElementById('nextPageBtn').addEventListener('click', () => {
            if (currentPage * itemsPerPage < calculationHistory.length) {
                currentPage++;
                updateHistoryList();
            }
        });

        // Event listener untuk tombol clear history
        document.getElementById('clearHistoryBtn').addEventListener('click', () => {
            clearHistory();
        });

        // Event listener untuk form submit
        document.getElementById('prodForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = getFormData();

            if (validateForm(formData)) {
                const results = calculateResults(formData);
                if (results) {
                    displayResults(results);
                    const warnings = generateWarnings(results, formData);
                    document.getElementById('warnings').innerHTML = warnings;
                    document.getElementById('results').classList.remove('hidden');
                    createCharts(results);
                    saveToHistory(formData, results); // Simpan perhitungan ke riwayat
                }
            }
        });

        // Fungsi untuk menampilkan halaman dan mengatur tautan aktif
        function showPage(pageId, link) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            const links = document.querySelectorAll('.nav-link-bottom');
            links.forEach(link => link.classList.remove('active'));
            link.classList.add('active');

            // Jika halaman yang ditampilkan adalah riwayat, perbarui daftarnya
            if (pageId === 'historyPage') {
                updateHistoryList();
            }
        }

        // Fungsi untuk menutup modal info
        function closeInfoModal() {
            document.getElementById('infoModal').style.display = 'none';
        }

        // Fungsi untuk menampilkan info EGI
        function displayEgiInfo() {
            const egiInfoModal = document.getElementById('egiInfoModal');
            let tableHTML = `<table class="egi-table">
                                <thead>
                                    <tr>
                                        <th>Jenis EGI</th>
                                        <th>Ritase (Target)</th>
                                        <th>Waktu Kerja Efektif (menit)</th>
                                        <th>CT HD (menit)</th>
                                        <th>Spotting Time (detik)</th>
                                        <th>Produktivitas (Target)</th>
                                        <th>Cycle Time (menit)</th>
                                        <th>Loading Time (menit)</th>
                                    </tr>
                                </thead>
                                <tbody>`;

            for (const vehicleType in targetValues) {
                if (targetValues.hasOwnProperty(vehicleType)) {
                    const egi = targetValues[vehicleType];
                    tableHTML += `
                        <tr>
                            <td>${vehicleType}</td>
                            <td>${egi.ritase}</td>
                            <td>${egi.wke}</td>
                            <td>${egi.ct}</td>
                            <td>${egi.st}</td>
                            <td>${egi.produktivitas}</td>
                            <td>${egi.cycleTime}</td>
                            <td>${egi.lt}</td>
                        </tr>`;
                }
            }

            tableHTML += `</tbody></table>`;
            egiInfoModal.innerHTML = tableHTML;
            document.getElementById('infoModal').style.display = 'block'; // Show the modal
        }

        // Fungsi untuk mengatur tema (terang/gelap)
        function setTheme(theme) {
            const body = document.body;
            if (theme === 'light') {
                body.classList.add('light-mode');
            } else {
                body.classList.remove('light-mode');
            }
            localStorage.setItem('theme', theme); // Simpan preferensi tema
        }

        // Event listener untuk pilihan tema
        document.getElementById('themeToggle').addEventListener('change', function () {
            setTheme(this.value);
        });

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme);
                document.getElementById('themeToggle').value = savedTheme;
            }

            const splashScreen = document.getElementById('splash-screen');
            setTimeout(() => {
                splashScreen.classList.add('hidden');
            }, 2000);

            loadHistory();
        });
    </script>
</body>

</html>